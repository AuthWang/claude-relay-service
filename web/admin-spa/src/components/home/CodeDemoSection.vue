<template>
  <section class="code-demo-section mb-8 md:mb-12">
    <div class="glass-strong p-6 shadow-xl md:p-8 lg:p-12">
      <div class="mx-auto max-w-6xl">
        <!-- æ ‡é¢˜ -->
        <div class="mb-8 text-center">
          <h2 class="mb-4 text-3xl font-bold text-gray-800 dark:text-gray-200 md:text-4xl">
            ğŸ Python AI åŠ©æ‰‹æ¼”ç¤º
          </h2>
        </div>

        <div class="grid gap-8 lg:grid-cols-2">
          <!-- ä»£ç æ¼”ç¤ºåŒºåŸŸ -->
          <div class="code-demo-container">
            <div class="code-window h-96 rounded-lg bg-gray-900 p-4 shadow-lg">
              <!-- çª—å£æ ‡é¢˜æ  -->
              <div class="mb-3 flex items-center gap-2">
                <div class="h-3 w-3 rounded-full bg-red-500"></div>
                <div class="h-3 w-3 rounded-full bg-yellow-500"></div>
                <div class="h-3 w-3 rounded-full bg-green-500"></div>
                <span class="ml-2 text-sm text-gray-400">Python AI Demo</span>
              </div>

              <!-- ä»£ç å†…å®¹ -->
              <div id="code-lines" class="code-content font-mono text-sm">
                <!-- ä»£ç è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
                <span class="typing-cursor">|</span>
              </div>
            </div>
          </div>

          <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
          <div class="result-container">
            <div class="result-card rounded-lg border border-green-500/30 bg-green-500/10 p-6">
              <div class="mb-4 flex items-center gap-2">
                <i class="fas fa-check-circle text-2xl text-green-500"></i>
                <h3 class="text-lg font-semibold text-green-700 dark:text-green-400">
                  âœ¨ Python AI åŠ©æ‰‹å°±ç»ªï¼
                </h3>
              </div>

              <div class="result-stats grid grid-cols-2 gap-4">
                <div class="stat-item text-center">
                  <div class="text-2xl font-bold text-green-600 dark:text-green-400">å¼‚æ­¥</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">é«˜å¹¶å‘</div>
                </div>
                <div class="stat-item text-center">
                  <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">ç±»å‹</div>
                  <div class="text-sm text-gray-600 dark:text-gray-400">å®‰å…¨æ€§</div>
                </div>
              </div>

              <!-- è¿›åº¦åŠ¨ç”» -->
              <div class="mt-4">
                <div class="progress-bar h-2 w-full rounded-full bg-gray-200 dark:bg-gray-700">
                  <div
                    class="progress-fill h-full rounded-full bg-gradient-to-r from-green-500 to-blue-500"
                  ></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</template>

<script setup>
import { onMounted, onUnmounted } from 'vue'

// Pythonä»£ç è¡Œæ•°æ®
const codeLines = [
  {
    content: '<span class="text-purple-400">class</span> <span class="text-blue-400">ClaudeAssistant</span><span class="text-white">:</span>',
    indent: 0
  },
  {
    content: '<span class="text-purple-400">def</span> <span class="text-blue-400">__init__</span><span class="text-white">(</span><span class="text-cyan-400">self</span><span class="text-white">, </span><span class="text-green-400">api_key</span><span class="text-white">: </span><span class="text-yellow-400">str</span><span class="text-white">):</span>',
    indent: 4
  },
  {
    content: '<span class="text-cyan-400">self</span><span class="text-white">.</span><span class="text-green-400">api_key</span><span class="text-white"> = </span><span class="text-green-400">api_key</span>',
    indent: 8
  },
  {
    content: '<span class="text-cyan-400">self</span><span class="text-white">.</span><span class="text-green-400">base_url</span><span class="text-white"> = </span><span class="text-orange-400">\'/api/v1/messages\'</span>',
    indent: 8
  },
  {
    content: '',
    indent: 0
  },
  {
    content: '<span class="text-purple-400">async def</span> <span class="text-blue-400">chat</span><span class="text-white">(</span><span class="text-cyan-400">self</span><span class="text-white">, </span><span class="text-green-400">message</span><span class="text-white">: </span><span class="text-yellow-400">str</span><span class="text-white">):</span>',
    indent: 4
  },
  {
    content: '<span class="text-green-400">response</span><span class="text-white"> = </span><span class="text-purple-400">await</span><span class="text-white"> </span><span class="text-cyan-400">self</span><span class="text-white">.</span><span class="text-blue-400">call_api</span><span class="text-white">({</span>',
    indent: 8
  },
  {
    content: '<span class="text-orange-400">\'model\'</span><span class="text-white">: </span><span class="text-orange-400">\'claude-sonnet-4\'</span><span class="text-white">,</span>',
    indent: 12
  },
  {
    content: '<span class="text-orange-400">\'messages\'</span><span class="text-white">: [{</span><span class="text-orange-400">\'content\'</span><span class="text-white">: </span><span class="text-green-400">message</span><span class="text-white">}]</span>',
    indent: 12
  },
  {
    content: '<span class="text-white">})</span>',
    indent: 8
  },
  {
    content: '<span class="text-purple-400">return</span><span class="text-white"> </span><span class="text-green-400">response</span><span class="text-white">.</span><span class="text-blue-400">get</span><span class="text-white">(</span><span class="text-orange-400">\'content\'</span><span class="text-white">)</span>',
    indent: 8
  }
]

let currentLineIndex = 0
let typingTimer = null

onMounted(() => {
  // å¯åŠ¨æ‰“å­—æœºåŠ¨ç”»
  startTypewriterEffect()

  // å¯åŠ¨è¿›åº¦æ¡åŠ¨ç”»
  setTimeout(() => {
    const progressFill = document.querySelector('.progress-fill')
    if (progressFill) {
      progressFill.style.width = '85%'
    }
  }, codeLines.length * 600 + 1000) // æ ¹æ®ä»£ç è¡Œæ•°è°ƒæ•´æ—¶é—´
})

const startTypewriterEffect = () => {
  const cursor = document.querySelector('.typing-cursor')
  const codeContainer = document.getElementById('code-lines')

  if (!codeContainer || !cursor) return

  // å¯åŠ¨å…‰æ ‡é—ªçƒ
  setInterval(() => {
    cursor.style.opacity = cursor.style.opacity === '0' ? '1' : '0'
  }, 500)

  // å¼€å§‹é€è¡Œæ·»åŠ ä»£ç 
  typingTimer = setInterval(() => {
    if (currentLineIndex < codeLines.length) {
      const line = codeLines[currentLineIndex]
      const lineElement = document.createElement('div')
      lineElement.className = 'mb-2'

      // æ·»åŠ ç¼©è¿›
      if (line.indent > 0) {
        lineElement.style.marginLeft = `${line.indent * 0.25}rem` // æ¯4ä¸ªç©ºæ ¼ = 1rem
      }

      lineElement.innerHTML = line.content

      // åœ¨å…‰æ ‡å‰æ’å…¥æ–°è¡Œ
      codeContainer.insertBefore(lineElement, cursor)
      currentLineIndex++
    } else {
      // æ‰€æœ‰ä»£ç è¡Œéƒ½å·²æ·»åŠ ï¼Œåœæ­¢å®šæ—¶å™¨
      clearInterval(typingTimer)
    }
  }, 600) // æ¯600msæ·»åŠ ä¸€è¡Œ
}

onUnmounted(() => {
  // æ¸…ç†å®šæ—¶å™¨
  if (typingTimer) {
    clearInterval(typingTimer)
  }
})
</script>

<style scoped>
.code-demo-section {
  position: relative;
}

/* ä»£ç çª—å£æ ·å¼ */
.code-window {
  background: #1a1a2e;
  border: 1px solid #333;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

/* æ‰“å­—æœºå…‰æ ‡ */
.typing-cursor {
  @apply text-white;
  animation: blink 1s infinite;
}

@keyframes blink {
  0%,
  50% {
    opacity: 1;
  }
  51%,
  100% {
    opacity: 0;
  }
}

/* è¿›åº¦æ¡åŠ¨ç”» */
.progress-fill {
  width: 0%;
  transition: width 2s ease-out;
  animation: shimmer 2s ease-in-out infinite;
}

@keyframes shimmer {
  0% {
    background-position: -200% center;
  }
  100% {
    background-position: 200% center;
  }
}

/* ç»“æœå¡ç‰‡åŠ¨ç”» */
.result-card {
  animation: slideInRight 1s ease-out 0.5s both;
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ä»£ç å®¹å™¨åŠ¨ç”» */
.code-demo-container {
  animation: slideInLeft 1s ease-out both;
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ç»Ÿè®¡é¡¹ç›®æ‚¬åœæ•ˆæœ */
.stat-item {
  transition: transform 0.3s ease;
}

.stat-item:hover {
  transform: scale(1.05);
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 1024px) {
  .code-content {
    @apply text-xs;
  }
}

@media (max-width: 640px) {
  .code-content {
    @apply text-xs;
  }

  .result-stats {
    @apply grid-cols-1 gap-2;
  }
}
</style>
